<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns:yui="http://yuilibrary.com/rdf/1.0/yui.rdf#">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<title>API: framework   ApplicationController.js  (mui Library)</title>

	<link rel="stylesheet" type="text/css" href="assets/reset-fonts-grids-min.css?stamp=1259613749.6" />
	<link rel="stylesheet" type="text/css" href="assets/api.css?stamp=1259613749.6" />

    <script type="text/javascript" src="assets/api-js?stamp=1259613749.6"></script>
    <script type="text/javascript" src="assets/ac-js?stamp=1259613749.6"></script>
	<script type="text/javascript" charset="utf-8">
		window.addEventListener('load', function() {
			document.getElementById('doc3').style.minHeight = window.innerHeight+'px'
		}, false);
	</script>
</head>

<body id="yahoo-com">

<div id="doc3" class="yui-t2">
	
	<div id="hd">
		<div class="primary">
			<h1><a href="" title="mui">mui</a></h1>

			<span class="description">Mobile User Interface <strong>v1.0.0</strong></span>
	
	       		<form onsubmit="return false">
	       			<div id="propertysearch">
					<span class="focus"></span>
					<input autocomplete="off" id="searchinput" placeholder="Search" />
	                		<div id="searchresults">
	                    			&nbsp;
	                		</div>
	            		</div>
	        	</form>
		</div>
		<div class="secondary">
			
			<div class="nav">
				<a href="./index.html" title="mui">mui</a>
	            		<span class="gt"></span> <a href="./module_framework.html" title="framework">framework</a>
	               		
	               		 <span class="gt"></span> ApplicationController.js (source view) 
			</div>

			<div class="meta">
		            	<form action="#" name="yui-classopts-form" method="get" id="yui-classopts-form">
		                	<fieldset>
		                    	<legend>Filters</legend>
		                	<span class="classopts"><input type="checkbox" name="show_private" id="show_private" /> <label for="show_private">Show Private</label></span>
		                	<span class="classopts"><input type="checkbox" name="show_protected" id="show_protected" /> <label for="show_protected">Show Protected</label></span>
		                	<span class="classopts"><input type="checkbox" name="show_deprecated" id="show_deprecated" /> <label for="show_deprecated">Show Deprecated</label></span>
		                	</fieldset>
		            	</form>
				<span class="subtitle">1.0.0</span>			
			</div>
	
			<div class="navdec"><b></b><b></b></div>
		</div>
	</div>

	<div id="bd">
		<div id="yui-main">
			<div id="doc-content" class="yui-b">

                    <div id="srcout">
                        <style>
                            #doc3 .classopts { display:none; }
                        </style>
<div class="highlight" ><pre><span class="c">/**</span>
<span class="c"> * Application Framework module</span>
<span class="c"> * @module framework</span>
<span class="c"> */</span>

<span class="c">/*</span>
<span class="c"> * Global DOM reference</span>
<span class="c"> * @final DOM</span>
<span class="c"> */</span>
<span class="k">const</span> <span class="nx">MUI_DOM</span> <span class="o">=</span> <span class="o">{</span>
	<span class="c">/* Common */</span>
	<span class="nx">loadingAttr</span><span class="o">:</span> <span class="s1">&#39;x-mui-loading&#39;</span><span class="o">,</span>
	
	<span class="c">/* Views */</span>
	<span class="nx">viewClassName</span><span class="o">:</span> <span class="s1">&#39;mui-view&#39;</span><span class="o">,</span>
	<span class="nx">viewShowingAttr</span><span class="o">:</span> <span class="s1">&#39;x-mui-showing&#39;</span>
<span class="o">};</span>

<span class="o">(</span><span class="k">function</span><span class="o">()</span> <span class="o">{</span>

<span class="c">/**</span>
<span class="c"> * Application controller constructor</span>
<span class="c"> * @class ApplicationController</span>
<span class="c"> * @constructor</span>
<span class="c"> * @param config {Object} Application configuration must include</span>
<span class="c"> * id, title, version </span>
<span class="c"> */</span>
<span class="k">function</span> <span class="nx">ApplicationController</span><span class="o">(</span><span class="nx">config</span><span class="o">)</span>
<span class="o">{</span>
	<span class="k">this</span><span class="o">.</span><span class="nx">appInfo</span> <span class="o">=</span> <span class="nx">config</span><span class="o">;</span>
	<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
<span class="o">};</span>

<span class="c">/**</span>
<span class="c"> * Return the instance of mui.ApplicationController</span>
<span class="c"> * @method getInstance</span>
<span class="c"> * @return the mui.ApplicationController instance</span>
<span class="c"> * @static</span>
<span class="c"> */</span>
<span class="nx">ApplicationController</span><span class="o">.</span><span class="nx">getInstance</span> <span class="o">=</span> <span class="k">function</span><span class="o">()</span>
<span class="o">{</span>
	<span class="k">return</span> <span class="nx">_instance</span><span class="o">;</span>
<span class="o">};</span>

<span class="c">/**</span>
<span class="c"> * Convenience utility for detecting object equality</span>
<span class="c"> * @method objectsEqual</span>
<span class="c"> * @param o1 {Object} The first object</span>
<span class="c"> * @param o2 {Object} The second object</span>
<span class="c"> * @return {Boolean} True if objects are equal, or false otherwise</span>
<span class="c"> * @static</span>
<span class="c"> */</span>
<span class="nx">ApplicationController</span><span class="o">.</span><span class="nx">objectsEqual</span> <span class="o">=</span> <span class="k">function</span><span class="o">(</span><span class="nx">o1</span><span class="o">,</span> <span class="nx">o2</span><span class="o">)</span>
<span class="o">{</span>
	<span class="k">var</span> <span class="nx">i</span><span class="o">;</span>
	<span class="k">if</span><span class="o">(!</span><span class="nx">o1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">o2</span><span class="o">)</span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
	<span class="k">if</span><span class="o">(</span><span class="k">typeof</span> <span class="nx">o1</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">o2</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span><span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
	<span class="k">for</span><span class="o">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">o1</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="k">if</span><span class="o">(</span><span class="nx">o1</span><span class="o">.</span><span class="nx">hasOwnProperty</span><span class="o">(</span><span class="nx">i</span><span class="o">))</span>
		<span class="o">{</span>
			<span class="k">if</span><span class="o">(!</span><span class="nx">o2</span><span class="o">.</span><span class="nx">hasOwnProperty</span><span class="o">(</span><span class="nx">i</span><span class="o">)</span> <span class="o">||</span> <span class="nx">o2</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span> <span class="o">!=</span> <span class="nx">o1</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span> <span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="k">for</span><span class="o">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">o2</span><span class="o">)</span> 
	<span class="o">{</span>
		<span class="k">if</span><span class="o">(</span><span class="nx">o2</span><span class="o">.</span><span class="nx">hasOwnProperty</span><span class="o">(</span><span class="nx">i</span><span class="o">))</span>
		<span class="o">{</span>
			<span class="k">if</span><span class="o">(!</span><span class="nx">o1</span><span class="o">.</span><span class="nx">hasOwnProperty</span><span class="o">(</span><span class="nx">i</span><span class="o">)</span> <span class="o">||</span> <span class="nx">o1</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span> <span class="o">!=</span> <span class="nx">o2</span><span class="o">[</span><span class="nx">i</span><span class="o">]</span> <span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
<span class="o">};</span>

<span class="c">/**</span>
<span class="c"> * Normalize window object</span>
<span class="c"> */</span>
<span class="k">var</span> <span class="nb">window</span> <span class="o">=</span> <span class="nb">window</span> <span class="o">||</span> <span class="nb">document</span><span class="o">.</span><span class="nx">defaultView</span><span class="o">;</span>

<span class="c">/**</span>
<span class="c"> * Cache instance variable</span>
<span class="c"> */</span>
<span class="k">var</span> <span class="nx">_instance</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="nx">ApplicationController</span><span class="o">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="o">{</span>

	<span class="c">/**</span>
<span class="c">	 * Array of registered controllers</span>
<span class="c">	 * @property _controllers</span>
<span class="c">	 * @type Array</span>
<span class="c">	 * @private</span>
<span class="c">	 */</span>
	<span class="nx">_controllers</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>
	
	<span class="c">/**</span>
<span class="c">	 * Reference to the mui.TabView object, if tabs are used</span>
<span class="c">	 * @property _tabView</span>
<span class="c">	 * @type mui.TabView</span>
<span class="c">	 * @private</span>
<span class="c">	 */</span>
	<span class="nx">_tabView</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>
	
	<span class="c">/**</span>
<span class="c">	 * Information about the viewport, such as whether or not full-screen</span>
<span class="c">	 * is activated</span>
<span class="c">	 * @property viewportInfo</span>
<span class="c">	 * @type Object</span>
<span class="c">	 */</span>
	<span class="nx">viewportInfo</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>
	
	<span class="c">/**</span>
<span class="c">	 * Reference to the currently visible view controller</span>
<span class="c">	 * @property visibleViewController</span>
<span class="c">	 * @type mui.ViewController</span>
<span class="c">	 */</span>
	<span class="nx">visibileViewController</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span>
	
	<span class="c">/**</span>
<span class="c">	 * State variable used to determine if view is being popped</span>
<span class="c">	 * @property popping</span>
<span class="c">	 * @type Boolean</span>
<span class="c">	 */</span>
	<span class="nx">popping</span><span class="o">:</span> <span class="kc">false</span><span class="o">,</span>
	
	<span class="c">/**</span>
<span class="c">	 * Event dispatcher</span>
<span class="c">	 * @method handleEvent</span>
<span class="c">	 * @param e {Event} The DOM event</span>
<span class="c">	 * @private</span>
<span class="c">	 */</span>
	<span class="nx">handleEvent</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">e</span><span class="o">)</span>
	<span class="o">{</span>
	
	<span class="o">},</span>

	<span class="c">/**</span>
<span class="c">	 * Remove any stale event listeners from the disappearing view controller, and attach event</span>
<span class="c">	 * listeners to the appearing view controller</span>
<span class="c">	 * @method _toggleEvents</span>
<span class="c">	 * @param oldVc {mui.ViewController} The disappearing view controller</span>
<span class="c">	 * @param newVc {mui.ViewController} The appearing view controller</span>
<span class="c">	 * @private</span>
<span class="c">	 */</span>
	<span class="nx">_toggleEvents</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">oldVc</span><span class="o">,</span> <span class="nx">newVc</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="k">if</span><span class="o">(</span><span class="nx">oldVc</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">if</span><span class="o">(</span><span class="nx">oldVc</span><span class="o">.</span><span class="nx">touchesBegan</span><span class="o">)</span> 	<span class="nx">mui</span><span class="o">.</span><span class="nx">removeEventListener</span><span class="o">(</span><span class="nx">oldVc</span><span class="o">.</span><span class="nx">view</span><span class="o">,</span> <span class="s1">&#39;touchstart&#39;</span><span class="o">,</span> <span class="nx">oldVc</span><span class="o">.</span><span class="nx">touchesBegan</span><span class="o">,</span> <span class="nx">oldVc</span><span class="o">);</span>
			<span class="k">if</span><span class="o">(</span><span class="nx">oldVc</span><span class="o">.</span><span class="nx">touchesMoved</span><span class="o">)</span> 	<span class="nx">mui</span><span class="o">.</span><span class="nx">removeEventListener</span><span class="o">(</span><span class="nx">oldVc</span><span class="o">.</span><span class="nx">view</span><span class="o">,</span> <span class="s1">&#39;touchmove&#39;</span><span class="o">,</span> <span class="nx">oldVc</span><span class="o">.</span><span class="nx">touchesMoved</span><span class="o">,</span> <span class="nx">oldVc</span><span class="o">);</span>
			<span class="k">if</span><span class="o">(</span><span class="nx">oldVc</span><span class="o">.</span><span class="nx">touchesEnded</span><span class="o">)</span> 	<span class="nx">mui</span><span class="o">.</span><span class="nx">removeEventListener</span><span class="o">(</span><span class="nx">oldVc</span><span class="o">.</span><span class="nx">view</span><span class="o">,</span> <span class="s1">&#39;touchend&#39;</span><span class="o">,</span> <span class="nx">oldVc</span><span class="o">.</span><span class="nx">touchesEnded</span><span class="o">,</span> <span class="nx">oldVc</span><span class="o">);</span>
			<span class="k">if</span><span class="o">(</span><span class="nx">oldVc</span><span class="o">.</span><span class="nx">clicked</span><span class="o">)</span> 	<span class="nx">mui</span><span class="o">.</span><span class="nx">removeEventListener</span><span class="o">(</span><span class="nx">oldVc</span><span class="o">.</span><span class="nx">view</span><span class="o">,</span> <span class="s1">&#39;click&#39;</span><span class="o">,</span> <span class="nx">oldVc</span><span class="o">.</span><span class="nx">clicked</span><span class="o">,</span> <span class="nx">oldVc</span><span class="o">);</span>
		<span class="o">}</span>
		
		<span class="k">if</span><span class="o">(</span><span class="nx">newVc</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">if</span><span class="o">(</span><span class="nx">newVc</span><span class="o">.</span><span class="nx">touchesBegan</span><span class="o">)</span> 	<span class="nx">mui</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="nx">newVc</span><span class="o">.</span><span class="nx">view</span><span class="o">,</span> <span class="s1">&#39;touchstart&#39;</span><span class="o">,</span> <span class="nx">newVc</span><span class="o">.</span><span class="nx">touchesBegan</span><span class="o">,</span> <span class="nx">newVc</span><span class="o">);</span>
			<span class="k">if</span><span class="o">(</span><span class="nx">newVc</span><span class="o">.</span><span class="nx">touchesMoved</span><span class="o">)</span> 	<span class="nx">mui</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="nx">newVc</span><span class="o">.</span><span class="nx">view</span><span class="o">,</span> <span class="s1">&#39;touchmove&#39;</span><span class="o">,</span> <span class="nx">newVc</span><span class="o">.</span><span class="nx">touchesMoved</span><span class="o">,</span> <span class="nx">newVc</span><span class="o">);</span>
			<span class="k">if</span><span class="o">(</span><span class="nx">newVc</span><span class="o">.</span><span class="nx">touchesEnded</span><span class="o">)</span> 	<span class="nx">mui</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="nx">newVc</span><span class="o">.</span><span class="nx">view</span><span class="o">,</span> <span class="s1">&#39;touchend&#39;</span><span class="o">,</span> <span class="nx">newVc</span><span class="o">.</span><span class="nx">touchesEnded</span><span class="o">,</span> <span class="nx">newVc</span><span class="o">);</span>
			<span class="k">if</span><span class="o">(</span><span class="nx">newVc</span><span class="o">.</span><span class="nx">clicked</span><span class="o">)</span> 	<span class="nx">mui</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="nx">newVc</span><span class="o">.</span><span class="nx">view</span><span class="o">,</span> <span class="s1">&#39;click&#39;</span><span class="o">,</span> <span class="nx">newVc</span><span class="o">.</span><span class="nx">clicked</span><span class="o">,</span> <span class="nx">newVc</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * Callback invoked after a view controller transition</span>
<span class="c">	 * @method _transitionEnd</span>
<span class="c">	 * @param newVc {mui.ViewController} The new visible view controller</span>
<span class="c">	 * @param oldVc {mui.ViewController} The old visible view controller</span>
<span class="c">	 * @private</span>
<span class="c">	 */</span>
	<span class="nx">_transitionEnd</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">newVc</span><span class="o">,</span> <span class="nx">oldVc</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="c">// Declare locals</span>
<span class="c"></span>		<span class="k">var</span> <span class="nx">scrollY</span> <span class="o">=</span> <span class="m">0</span><span class="o">,</span> 
		    <span class="nx">viewY</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">getXY</span><span class="o">(</span><span class="nx">newVc</span><span class="o">.</span><span class="nx">view</span><span class="o">)[</span><span class="m">1</span><span class="o">],</span>
		    <span class="nx">navbar</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s1">&#39;.mui-navbar[x-mui-showing=true]&#39;</span><span class="o">);</span>

		<span class="c">// Restore content heights</span>
<span class="c"></span>		<span class="nx">newVc</span><span class="o">.</span><span class="nx">view</span><span class="o">.</span><span class="nx">style</span><span class="o">.</span><span class="nx">maxHeight</span> <span class="o">=</span> <span class="nx">oldVc</span><span class="o">.</span><span class="nx">view</span><span class="o">.</span><span class="nx">style</span><span class="o">.</span><span class="nx">maxHeight</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">;</span>
		
		<span class="c">// Disappear</span>
<span class="c"></span>		<span class="nx">oldVc</span><span class="o">.</span><span class="nx">disappear</span><span class="o">();</span>
		
		<span class="c">// Callbacks</span>
<span class="c"></span>		<span class="nx">oldVc</span><span class="o">.</span><span class="nx">viewDidDisappear</span><span class="o">();</span>
		<span class="nx">newVc</span><span class="o">.</span><span class="nx">viewDidAppear</span><span class="o">();</span>
		
		<span class="c">// Set visibleViewController member</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span> <span class="o">=</span> <span class="nx">newVc</span><span class="o">;</span>
		
		<span class="c">// Find scrollY</span>
<span class="c"></span>		<span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">.</span><span class="nx">scrollY</span><span class="o">)</span> <span class="nx">scrollY</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">.</span><span class="nx">scrollY</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="nx">scrollY</span> <span class="o">&lt;</span> <span class="nx">viewY</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span><span class="o">)</span> <span class="nx">scrollY</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">getXY</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span><span class="o">.</span><span class="nx">element</span><span class="o">)[</span><span class="m">1</span><span class="o">];</span>
			<span class="k">else</span> <span class="nx">scrollY</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">getXY</span><span class="o">(</span><span class="nx">navbar</span><span class="o">)[</span><span class="m">1</span><span class="o">];</span>
		<span class="o">}</span>
		
		<span class="c">// @TODO: figure out what to do about this scroll jumping.... for now, always scroll to navigation-bar</span>
<span class="c"></span>		<span class="c">// if(this.visibleViewController.scrollY) setTimeout(scrollTo, 0, 0, scrollY);</span>
<span class="c"></span>	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * Callback triggered whenever the URL is changed</span>
<span class="c">	 * @method _urlChanged</span>
<span class="c">	 * @param url {String} The current URL</span>
<span class="c">	 * @param params {Object} Any request parameters</span>
<span class="c">	 * @param navController {mui.NavigationController} The navigation controller to appear</span>
<span class="c">	 * @param viewControllerName {String} The NAME of the view controller to appear</span>
<span class="c">	 * @private</span>
<span class="c">	 */</span>
	<span class="nx">_urlChanged</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">url</span><span class="o">,</span> <span class="nx">params</span><span class="o">,</span> <span class="nx">navController</span><span class="o">,</span> <span class="nx">viewControllerName</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="c">// Get the viewController</span>
<span class="c"></span>		<span class="k">var</span> <span class="nx">viewController</span> <span class="o">=</span> <span class="nx">navController</span><span class="o">.</span><span class="nx">getViewController</span><span class="o">(</span><span class="nx">viewControllerName</span><span class="o">);</span>
		<span class="k">var</span> <span class="nx">doTransition</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
		<span class="k">var</span> <span class="nx">reverse</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
		<span class="k">var</span> <span class="nx">poppedVc</span><span class="o">,</span> <span class="nx">pushedVc</span><span class="o">,</span> <span class="nx">navIndex</span><span class="o">;</span>
		
		<span class="c">// Load the view, if it is not already loaded</span>
<span class="c"></span>		<span class="k">if</span><span class="o">(!</span><span class="nx">viewController</span><span class="o">.</span><span class="nx">isViewLoaded</span><span class="o">())</span>
		<span class="o">{</span>
			<span class="nx">viewController</span><span class="o">.</span><span class="nx">loadView</span><span class="o">(</span><span class="nx">params</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="c">// Make sure navigationController property is set on viewController</span>
<span class="c"></span>		<span class="nx">viewController</span><span class="o">.</span><span class="nx">navigationController</span> <span class="o">=</span> <span class="nx">navController</span><span class="o">;</span>

		<span class="c">// Check if required viewControllers are not yet loaded</span>
<span class="c"></span>		<span class="k">if</span><span class="o">(</span><span class="nx">viewController</span><span class="o">.</span><span class="nx">requires</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="nx">viewController</span><span class="o">.</span><span class="nx">navigationController</span><span class="o">.</span><span class="nx">loadViewControllers</span><span class="o">(</span><span class="nx">viewController</span><span class="o">.</span><span class="nx">requires</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="c">// Check if viewController belongs to currently showing navigation controller</span>
<span class="c"></span>		<span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">.</span><span class="nx">navigationController</span><span class="o">.</span><span class="nx">NAME</span> <span class="o">===</span> <span class="nx">navController</span><span class="o">.</span><span class="nx">NAME</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="nx">doTransition</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">)</span> <span class="c">// Hide active navigation bar for tab-to-tab switch</span>
<span class="c"></span>		<span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">.</span><span class="nx">navigationController</span><span class="o">.</span><span class="nx">hideNavigationBar</span><span class="o">();</span>
			
			<span class="c">// Activate tab, if not already</span>
<span class="c"></span>			<span class="nx">navIndex</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_controllers</span><span class="o">.</span><span class="nx">indexOf</span><span class="o">(</span><span class="nx">navController</span><span class="o">);</span>
			<span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span><span class="o">.</span><span class="nx">activeIndex</span> <span class="o">!==</span> <span class="nx">navIndex</span><span class="o">)</span>
			<span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span><span class="o">.</span><span class="nx">activateTabAtIndex</span><span class="o">(</span><span class="nx">navIndex</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="k">if</span><span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span><span class="o">.</span><span class="nx">activateTabAtIndex</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_controllers</span><span class="o">.</span><span class="nx">indexOf</span><span class="o">(</span><span class="nx">navController</span><span class="o">));</span>
		<span class="o">}</span>
		
		<span class="c">// Attach/Detach touch events</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">_toggleEvents</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">,</span> <span class="nx">viewController</span><span class="o">);</span>
		
		<span class="c">// Position the view controller</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">positionViewController</span><span class="o">(</span><span class="nx">viewController</span><span class="o">);</span>
		
		<span class="c">// Push or Pop view controller</span>
<span class="c"></span>		<span class="nx">poppedVc</span> <span class="o">=</span> <span class="nx">navController</span><span class="o">.</span><span class="nx">getViewControllerFromStack</span><span class="o">(</span><span class="nx">viewController</span><span class="o">,</span> <span class="nx">params</span><span class="o">);</span>
		<span class="k">if</span><span class="o">(!</span><span class="nx">poppedVc</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="nx">pushedVc</span> <span class="o">=</span> <span class="nx">navController</span><span class="o">.</span><span class="nx">pushToViewController</span><span class="o">(</span><span class="nx">viewController</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
			<span class="k">if</span><span class="o">(</span><span class="nx">pushedVc</span> <span class="o">&amp;&amp;</span> <span class="nx">viewController</span><span class="o">.</span><span class="nx">isViewLoaded</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">mui</span><span class="o">.</span><span class="nx">ApplicationController</span><span class="o">.</span><span class="nx">objectsEqual</span><span class="o">(</span><span class="nx">params</span><span class="o">,</span> <span class="nx">pushedVc</span><span class="o">.</span><span class="nx">params</span><span class="o">))</span>
			<span class="o">{</span>
				<span class="nx">viewController</span><span class="o">.</span><span class="nx">reloadView</span><span class="o">(</span><span class="nx">params</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="nx">navController</span><span class="o">.</span><span class="nx">pushViewController</span><span class="o">(</span><span class="nx">viewController</span><span class="o">,</span> <span class="nx">params</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="nx">poppedVc</span><span class="o">.</span><span class="nx">NAME</span> <span class="o">!==</span> <span class="nx">navController</span><span class="o">.</span><span class="nx">getTopViewController</span><span class="o">().</span><span class="nx">NAME</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">popping</span> <span class="o">=</span> <span class="nx">reverse</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
			<span class="nx">navController</span><span class="o">.</span><span class="nx">popViewController</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
		<span class="o">}</span>
		
		<span class="c">// Check if popping</span>
<span class="c"></span>		<span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">popping</span><span class="o">)</span> <span class="nx">reverse</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

		<span class="c">// Store scrollY for outgoing view</span>
<span class="c"></span>		<span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">.</span><span class="nx">scrollY</span> <span class="o">=</span> <span class="nb">window</span><span class="o">.</span><span class="nx">scrollY</span><span class="o">;</span>

		<span class="c">// Show/Transition the view controller</span>
<span class="c"></span>		<span class="k">if</span><span class="o">(</span><span class="nx">doTransition</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">Transition</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="nx">showViewControllerWithTransition</span><span class="o">(</span><span class="nx">viewController</span><span class="o">,</span> <span class="nx">viewController</span><span class="o">.</span><span class="nx">getTransition</span><span class="o">(),</span> <span class="nx">reverse</span><span class="o">);</span>
		<span class="k">else</span> <span class="k">this</span><span class="o">.</span><span class="nx">showViewController</span><span class="o">(</span><span class="nx">viewController</span><span class="o">);</span>
	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * TabChange event handler for the mui.TabView activates the navigation controller</span>
<span class="c">	 * corresponding to the tab</span>
<span class="c">	 * @method _tabChanged</span>
<span class="c">	 * @param index {Number} The index of the tab which the user selected</span>
<span class="c">	 * @private</span>
<span class="c">	 */</span>
	<span class="nx">_tabChanged</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">index</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="c">// Get the navigation controller for the tab</span>
<span class="c"></span>		<span class="k">var</span> <span class="nx">navController</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_controllers</span><span class="o">[</span><span class="nx">index</span><span class="o">];</span>
		<span class="k">if</span><span class="o">(</span><span class="nx">navController</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="c">// Scroll to the tabs</span>
<span class="c"></span>			<span class="nx">scrollTo</span><span class="o">(</span><span class="m">0</span><span class="o">,</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">getXY</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span><span class="o">.</span><span class="nx">element</span><span class="o">)[</span><span class="m">1</span><span class="o">]);</span>
			<span class="nb">document</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">style</span><span class="o">.</span><span class="nx">minHeight</span> <span class="o">=</span> <span class="s1">&#39;10000px&#39;</span><span class="o">;</span>
			<span class="nx">setTimeout</span><span class="o">(</span><span class="nx">mui</span><span class="o">.</span><span class="nx">setStyle</span><span class="o">,</span> <span class="m">10</span><span class="o">,</span> <span class="nb">document</span><span class="o">.</span><span class="nx">body</span><span class="o">,</span> <span class="s1">&#39;minHeight&#39;</span><span class="o">,</span> <span class="s1">&#39;&#39;</span><span class="o">);</span>
			
			<span class="c">// Open the last URL in the navigation stack</span>
<span class="c"></span>			<span class="k">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">navController</span><span class="o">.</span><span class="nx">getLastUrl</span><span class="o">();</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">openUrl</span><span class="o">(</span><span class="nx">url</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * TabRefresh event handler for the mui.TabView activates the navigation controller&#39;s root view controller</span>
<span class="c">	 * corresponding to the tab</span>
<span class="c">	 * @method _tabRefreshed</span>
<span class="c">	 * @param index {Number} The index of the tab which the user selected</span>
<span class="c">	 * @private</span>
<span class="c">	 */</span>
	<span class="nx">_tabRefreshed</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">index</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="c">// Get the navigation controller for the tab</span>
<span class="c"></span>		<span class="k">var</span> <span class="nx">navController</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_controllers</span><span class="o">[</span><span class="nx">index</span><span class="o">];</span>
		<span class="k">if</span><span class="o">(</span><span class="nx">navController</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="c">// Pop to root view controller</span>
<span class="c"></span>			<span class="nx">navController</span><span class="o">.</span><span class="nx">popToRootViewController</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * Position the viewcontroller in the viewport, taking up as much vertical space as available</span>
<span class="c">	 * @method positionViewController</span>
<span class="c">	 * @param viewController {mui.ViewController} The view controller</span>
<span class="c">	 * @return {mui.ApplicationController} The AppController instance</span>
<span class="c">	 */</span>
	<span class="nx">positionViewController</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">viewController</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="k">var</span> <span class="nx">viewNode</span> <span class="o">=</span> <span class="nx">viewController</span><span class="o">.</span><span class="nx">view</span><span class="o">,</span>
		    <span class="nx">navbar</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s1">&#39;.mui-navbar[x-mui-showing=true]&#39;</span><span class="o">),</span>
		    <span class="nx">navbarHeight</span> <span class="o">=</span> <span class="nx">navbar</span> <span class="o">?</span> <span class="nx">navbar</span><span class="o">.</span><span class="nx">offsetHeight</span> <span class="o">:</span> <span class="m">0</span><span class="o">,</span>
		    <span class="nx">header</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s1">&#39;header&#39;</span><span class="o">),</span> <span class="nx">headerHeight</span> <span class="o">=</span> <span class="o">(</span><span class="nx">header</span> <span class="o">?</span> <span class="nx">header</span><span class="o">.</span><span class="nx">offsetHeight</span> <span class="o">:</span> <span class="m">0</span><span class="o">),</span>
		    <span class="nx">footer</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s1">&#39;footer&#39;</span><span class="o">),</span> <span class="nx">footerHeight</span> <span class="o">=</span> <span class="o">(</span><span class="nx">footer</span> <span class="o">?</span> <span class="nx">footer</span><span class="o">.</span><span class="nx">offsetHeight</span> <span class="o">:</span> <span class="m">0</span><span class="o">);</span>

		<span class="nx">viewNode</span><span class="o">.</span><span class="nx">style</span><span class="o">.</span><span class="nx">minHeight</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="o">(</span><span class="nb">window</span><span class="o">.</span><span class="nx">innerHeight</span> <span class="o">-</span> <span class="nx">footerHeight</span> <span class="o">+</span> <span class="o">-</span> <span class="nx">navbarHeight</span><span class="o">)</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="o">;</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
	<span class="o">},</span>

	<span class="c">/**</span>
<span class="c">	 * Show a viewController on-screen, making it the visibleViewController</span>
<span class="c">	 * @method showViewController</span>
<span class="c">	 * @param viewController {mui.ViewController} The ViewController to show.</span>
<span class="c">	 * @param reloading {Boolean} Whether or not the view is reloading, used to maintain scroll offset</span>
<span class="c">	 */</span>
	<span class="nx">showViewController</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">viewController</span><span class="o">,</span> <span class="nx">reloading</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="c">// Set animation flag</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">animating</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
		
		<span class="c">// Disappear</span>
<span class="c"></span>		<span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">.</span><span class="nx">viewWillDisappear</span><span class="o">();</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">.</span><span class="nx">disappear</span><span class="o">();</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">.</span><span class="nx">viewDidDisappear</span><span class="o">();</span>
		<span class="o">}</span>
		
		<span class="c">// Appear</span>
<span class="c"></span>		<span class="nx">viewController</span><span class="o">.</span><span class="nx">viewWillAppear</span><span class="o">();</span>
		<span class="nx">viewController</span><span class="o">.</span><span class="nx">appear</span><span class="o">();</span>
		<span class="nx">viewController</span><span class="o">.</span><span class="nx">viewDidAppear</span><span class="o">();</span>
		
		<span class="c">// Set visibleViewController member</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span> <span class="o">=</span> <span class="nx">viewController</span><span class="o">;</span>
		
		<span class="c">// Reset popping flag</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">popping</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * Show a viewController on-screen with a transition, making it the visibleViewController</span>
<span class="c">	 * @method showViewController</span>
<span class="c">	 * @param viewController {mui.ViewController} The ViewController to show.</span>
<span class="c"> 	 * @param transition {Object} Object literal defining the transition</span>
<span class="c"> 	 * @param reverse {Boolean} Should transition be executed in reverse</span>
<span class="c">	 * @param reloading {Boolean} Whether or not the view is reloading, used to maintain scroll offset</span>
<span class="c">	 */</span>
	<span class="nx">showViewControllerWithTransition</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">viewController</span><span class="o">,</span> <span class="nx">transition</span><span class="o">,</span> <span class="nx">reverse</span><span class="o">,</span> <span class="nx">reloading</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="c">// Declare locals</span>
<span class="c"></span>		<span class="k">var</span> <span class="nx">trans</span><span class="o">,</span> <span class="nx">options</span><span class="o">,</span> <span class="nx">navbar</span><span class="o">,</span> <span class="nx">scrollY</span><span class="o">;</span>
		
		<span class="c">// Set animation flag</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">animating</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
		
		<span class="c">// Scroll</span>
<span class="c"></span>		<span class="nx">navbar</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">get</span><span class="o">(</span><span class="s1">&#39;.mui-navbar[x-mui-showing=true]&#39;</span><span class="o">);</span>
		<span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span><span class="o">)</span> <span class="nx">scrollY</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">getXY</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span><span class="o">.</span><span class="nx">element</span><span class="o">)[</span><span class="m">1</span><span class="o">];</span>
		<span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="nx">navbar</span><span class="o">)</span> <span class="nx">scrollY</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">getXY</span><span class="o">(</span><span class="nx">navbar</span><span class="o">)[</span><span class="m">1</span><span class="o">];</span>
		<span class="k">else</span> <span class="nx">scrollY</span> <span class="o">=</span> <span class="m">0</span><span class="o">;</span>
		<span class="nx">scrollTo</span><span class="o">(</span><span class="m">0</span><span class="o">,</span> <span class="nx">scrollY</span><span class="o">);</span>
		<span class="c">// scrollTo(0, 0);</span>
<span class="c"></span>		
		<span class="c">// Cut-off content not in viewport</span>
<span class="c"></span>		<span class="nx">viewController</span><span class="o">.</span><span class="nx">view</span><span class="o">.</span><span class="nx">style</span><span class="o">.</span><span class="nx">maxHeight</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">.</span><span class="nx">view</span><span class="o">.</span><span class="nx">style</span><span class="o">.</span><span class="nx">maxHeight</span> <span class="o">=</span> <span class="o">(</span><span class="nb">window</span><span class="o">.</span><span class="nx">innerHeight</span><span class="o">*</span><span class="m">2</span><span class="o">)+</span><span class="s1">&#39;px&#39;</span><span class="o">;</span>

		<span class="c">// Initialize transition options</span>
<span class="c"></span>		<span class="nx">options</span> <span class="o">=</span> <span class="o">{};</span>
		<span class="nx">options</span><span class="o">.</span><span class="nx">reverse</span> <span class="o">=</span> <span class="nx">reverse</span><span class="o">;</span>
		<span class="nx">options</span><span class="o">.</span><span class="nx">onComplete</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">bind</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_transitionEnd</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="nx">viewController</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">);</span>
		
		<span class="c">// Setup transition</span>
<span class="c"></span>		<span class="nx">trans</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">Transition</span><span class="o">(</span><span class="nx">viewController</span><span class="o">.</span><span class="nx">view</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">.</span><span class="nx">view</span><span class="o">,</span> <span class="nx">options</span><span class="o">);</span>
		
		<span class="c">// Show incoming view</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">visibleViewController</span><span class="o">.</span><span class="nx">viewWillDisappear</span><span class="o">();</span>
		<span class="nx">viewController</span><span class="o">.</span><span class="nx">viewWillAppear</span><span class="o">();</span>
		<span class="nx">viewController</span><span class="o">.</span><span class="nx">appear</span><span class="o">();</span>
				
		<span class="c">// Execute transition</span>
<span class="c"></span>		<span class="nx">setTimeout</span><span class="o">(</span><span class="nx">mui</span><span class="o">.</span><span class="nx">bind</span><span class="o">(</span><span class="nx">trans</span><span class="o">.</span><span class="nx">execute</span><span class="o">,</span> <span class="nx">trans</span><span class="o">),</span> <span class="m">0</span><span class="o">);</span>
		
		<span class="c">// Reset popping flag</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">popping</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * Set the element for the application. Use this method in conjuction with</span>
<span class="c">	 * registerController to map a navigationController to a particular tab</span>
<span class="c">	 * @method setTabsElement</span>
<span class="c">	 * @param el {String|HTMLElement} Selector or HTMLElement for the tabs container</span>
<span class="c">	 */</span>
	<span class="nx">setTabsElement</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">el</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="k">if</span><span class="o">(</span><span class="k">typeof</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">TabView</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">TabView</span><span class="o">(</span><span class="nx">el</span><span class="o">);</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span><span class="o">.</span><span class="nx">tabChanged</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">bind</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_tabChanged</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">_tabView</span><span class="o">.</span><span class="nx">tabRefreshed</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">bind</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_tabRefreshed</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">},</span>

	<span class="c">/**</span>
<span class="c">	 * Register a controller with the application. If tabEl is passed in, the</span>
<span class="c">	 * navigationController will be mapped to that tab.</span>
<span class="c">	 * @method registerController</span>
<span class="c">	 * @param controller {mui.NavigationController} The controller to register</span>
<span class="c">	 */</span>
	<span class="nx">registerController</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">controller</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="c">// Initialize _controllers if not defined yet</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">_controllers</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="nx">_controllers</span> <span class="o">||</span> <span class="o">[];</span>

		<span class="c">// Push controller onto controller stack</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">_controllers</span><span class="o">.</span><span class="nx">push</span><span class="o">(</span><span class="nx">controller</span><span class="o">);</span>
		
		<span class="c">// Make sure DOM node exists for each viewController, and map URLs into navigator</span>
<span class="c"></span>		<span class="nx">mui</span><span class="o">.</span><span class="nx">each</span><span class="o">(</span><span class="nx">controller</span><span class="o">.</span><span class="nx">viewControllers</span><span class="o">,</span> <span class="k">function</span><span class="o">(</span><span class="nx">vc</span><span class="o">)</span> <span class="o">{</span>
			
			<span class="c">// View node</span>
<span class="c"></span>			<span class="k">var</span> <span class="nx">vcName</span> <span class="o">=</span> <span class="nx">vc</span><span class="o">.</span><span class="nx">NAME</span> <span class="o">||</span> <span class="nx">vc</span><span class="o">.</span><span class="nx">prototype</span><span class="o">.</span><span class="nx">NAME</span><span class="o">;</span>
			<span class="k">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">controller</span><span class="o">.</span><span class="nx">NAME</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">vcName</span><span class="o">;</span>
			
			<span class="c">// Map URL</span>
<span class="c"></span>			<span class="k">this</span><span class="o">.</span><span class="nx">navigator</span><span class="o">.</span><span class="nx">mapUrl</span><span class="o">(</span><span class="nx">id</span><span class="o">,</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">bind</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_urlChanged</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="nx">controller</span><span class="o">,</span> <span class="nx">vcName</span><span class="o">));</span>
		<span class="o">},</span> <span class="k">this</span><span class="o">);</span>

		<span class="c">// Initialize controller</span>
<span class="c"></span>		<span class="nx">controller</span><span class="o">.</span><span class="nx">initialize</span><span class="o">();</span>
	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * Open a URL - retrieve the navigationController to which</span>
<span class="c">	 * the URL belongs to and trigger it&#39;s load/appear sequence. </span>
<span class="c">	 * This method will also perform the view transition, if defined.</span>
<span class="c">	 * URL&#39;s are defined as the navigationController&#39;s name, followed by</span>
<span class="c">	 * a slash, followed by the viewController&#39;s name, with any URL parameters</span>
<span class="c">	 * following that. Leading slashes are ignored.</span>
<span class="c">	 * Example: &#39;/stories/list&#39; is equivalent to &#39;stories/list&#39;</span>
<span class="c">	 * @method openUrl</span>
<span class="c">	 * @param url {String} The URL to open</span>
<span class="c">	 * @param quiet {Boolean} (Optional) Prevent the viewController load sequence. Pass</span>
<span class="c">	 *   true if you just want to set the window hash, and not trigger the load/appear sequence	</span>
<span class="c">	 * @return {Boolean} Returns false if url is not mapped to any </span>
<span class="c">	 *   controller</span>
<span class="c">	 */</span>
	<span class="nx">openUrl</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">url</span><span class="o">,</span> <span class="nx">quiet</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="k">if</span><span class="o">(</span><span class="nx">quiet</span> <span class="o">===</span> <span class="kc">true</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">navigator</span><span class="o">.</span><span class="nx">openUrl</span><span class="o">(</span><span class="nx">url</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
			<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">this</span><span class="o">.</span><span class="nx">navigator</span><span class="o">.</span><span class="nx">openUrl</span><span class="o">(</span><span class="nx">url</span><span class="o">);</span>
	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * This is a convenience method for showing a viewController without constructing a URL.</span>
<span class="c">	 * The URL is built based on the viewController&#39;s name + the params that are passed in.</span>
<span class="c">	 * @method openViewController</span>
<span class="c">	 * @param viewController {mui.ViewController} the ViewController</span>
<span class="c">	 * @param params {Object} Any request params</span>
<span class="c">	 */</span>
	<span class="nx">openViewController</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">viewController</span><span class="o">,</span> <span class="nx">params</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="k">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="nx">viewController</span><span class="o">.</span><span class="nx">navigationController</span><span class="o">)</span> <span class="nx">url</span> <span class="o">+=</span> <span class="nx">viewController</span><span class="o">.</span><span class="nx">navigationController</span><span class="o">.</span><span class="nx">NAME</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">;</span>
		<span class="nx">url</span> <span class="o">+=</span> <span class="nx">viewController</span><span class="o">.</span><span class="nx">NAME</span><span class="o">;</span>
		<span class="k">if</span><span class="o">(</span><span class="nx">params</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="nx">url</span> <span class="o">+=</span> <span class="s1">&#39;?&#39;</span><span class="o">;</span>
			<span class="nx">mui</span><span class="o">.</span><span class="nx">iterate</span><span class="o">(</span><span class="nx">params</span><span class="o">,</span> <span class="k">function</span><span class="o">(</span><span class="nx">v</span><span class="o">,</span> <span class="nx">n</span><span class="o">)</span> <span class="o">{</span> <span class="nx">url</span> <span class="o">+=</span> <span class="o">[</span><span class="nx">n</span><span class="o">,</span> <span class="nx">v</span><span class="o">].</span><span class="nx">join</span><span class="o">(</span><span class="s1">&#39;=&#39;</span><span class="o">);</span> <span class="nx">url</span> <span class="o">+=</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">;</span> <span class="o">});</span>
			<span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="o">.</span><span class="nx">substr</span><span class="o">(</span><span class="m">0</span><span class="o">,</span> <span class="nx">url</span><span class="o">.</span><span class="nx">length</span><span class="o">-</span><span class="m">1</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">this</span><span class="o">.</span><span class="nx">openUrl</span><span class="o">(</span><span class="nx">url</span><span class="o">);</span>
	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * Get a navigation controller by name</span>
<span class="c">	 * @method getController</span>
<span class="c">	 * @param name {String} The name of the controller</span>
<span class="c">	 * @return The controller, or null, if not found</span>
<span class="c">	 */</span>
	<span class="nx">getController</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">name</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="k">var</span> <span class="nx">ctrl</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="nx">mui</span><span class="o">.</span><span class="nx">each</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_controllers</span><span class="o">,</span> <span class="k">function</span><span class="o">(</span><span class="nx">c</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span><span class="o">(</span><span class="nx">c</span><span class="o">.</span><span class="nx">NAME</span> <span class="o">===</span> <span class="nx">name</span><span class="o">)</span> <span class="nx">ctrl</span> <span class="o">=</span> <span class="nx">c</span><span class="o">;</span>
		<span class="o">},</span> <span class="k">this</span><span class="o">);</span>
		<span class="k">return</span> <span class="nx">ctrl</span><span class="o">;</span>
	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * Restore the state of the application. If no state is available,</span>
<span class="c">	 * the fallback URL will be opened</span>
<span class="c">	 * @method restore</span>
<span class="c">	 * @param fallbackUrl {String} URL to be opened if there is nothing to restore</span>
<span class="c">	 * @return {mui.ApplicationController} The AppController instance</span>
<span class="c">	 */</span>
	<span class="nx">restore</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">fallbackUrl</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="k">if</span><span class="o">(</span><span class="nx">mui</span><span class="o">.</span><span class="nx">Storage</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">storage</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">Storage</span><span class="o">.</span><span class="nx">open</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">appInfo</span><span class="o">.</span><span class="nx">id</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="nx">appInfo</span><span class="o">.</span><span class="nx">version</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="nx">appInfo</span><span class="o">.</span><span class="nx">title</span><span class="o">);</span>
			<span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">appInfo</span><span class="o">.</span><span class="nx">persistenceMode</span> <span class="o">!==</span> <span class="s1">&#39;none&#39;</span><span class="o">)</span>
			<span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">storage</span><span class="o">.</span><span class="nx">transaction</span><span class="o">(</span><span class="nx">mui</span><span class="o">.</span><span class="nx">bind</span><span class="o">(</span><span class="k">function</span><span class="o">(</span><span class="nx">tx</span><span class="o">)</span> <span class="o">{</span>
					<span class="nx">tx</span><span class="o">.</span><span class="nx">executeSql</span><span class="o">(</span><span class="s1">&#39;CREATE TABLE IF NOT EXISTS mui_config (name VARCHAR(32) PRIMARY KEY, value TEXT)&#39;</span><span class="o">,</span> <span class="o">[],</span> <span class="k">function</span><span class="o">(</span><span class="nx">tx</span><span class="o">,</span> <span class="nx">rs</span><span class="o">)</span> <span class="o">{</span>
						<span class="nx">tx</span><span class="o">.</span><span class="nx">executeSql</span><span class="o">(</span><span class="s1">&#39;SELECT * FROM mui_config WHERE name = &quot;version&quot;&#39;</span><span class="o">,</span> <span class="o">[],</span> <span class="k">function</span><span class="o">(</span><span class="nx">tx</span><span class="o">,</span> <span class="nx">rs</span><span class="o">)</span> <span class="o">{</span>
							<span class="k">var</span> <span class="nx">version</span><span class="o">;</span>

							<span class="k">function</span> <span class="nx">restoreViewControllers</span><span class="o">()</span>
							<span class="o">{</span>
								<span class="nx">tx</span><span class="o">.</span><span class="nx">executeSql</span><span class="o">(</span><span class="s1">&#39;CREATE TABLE IF NOT EXISTS mui_controllers (nav_controller VARCHAR(32) PRIMARY KEY, stack TEXT)&#39;</span><span class="o">,</span> <span class="o">[],</span> <span class="k">function</span><span class="o">(</span><span class="nx">tx</span><span class="o">,</span> <span class="nx">rs</span><span class="o">)</span> <span class="o">{</span>
									<span class="nx">tx</span><span class="o">.</span><span class="nx">executeSql</span><span class="o">(</span><span class="s1">&#39;SELECT * FROM mui_controllers&#39;</span><span class="o">,</span> <span class="o">[],</span> <span class="k">function</span><span class="o">(</span><span class="nx">tx</span><span class="o">,</span> <span class="nx">rs</span><span class="o">)</span> <span class="o">{</span>
										<span class="k">if</span><span class="o">(</span><span class="nx">rs</span><span class="o">.</span><span class="nx">rows</span><span class="o">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="m">0</span><span class="o">)</span>
										<span class="o">{</span>
											<span class="k">var</span> <span class="nx">topNc</span><span class="o">,</span> <span class="nx">cTime</span> <span class="o">=</span> <span class="m">0</span><span class="o">;</span>
											<span class="k">for</span><span class="o">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">=</span><span class="m">0</span><span class="o">,</span> <span class="nx">len</span><span class="o">=</span><span class="nx">rs</span><span class="o">.</span><span class="nx">rows</span><span class="o">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="o">;</span> <span class="nx">i</span><span class="o">++)</span>
											<span class="o">{</span>
												<span class="k">var</span> <span class="nx">navCon</span> <span class="o">=</span> <span class="nx">_instance</span><span class="o">.</span><span class="nx">getController</span><span class="o">(</span><span class="nx">rs</span><span class="o">.</span><span class="nx">rows</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">i</span><span class="o">).</span><span class="nx">nav_controller</span><span class="o">);</span>
												<span class="k">if</span><span class="o">(</span><span class="nx">navCon</span><span class="o">)</span>
												<span class="o">{</span>
													<span class="k">var</span> <span class="nx">stack</span> <span class="o">=</span> <span class="nb">eval</span><span class="o">(</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="nx">rs</span><span class="o">.</span><span class="nx">rows</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">i</span><span class="o">).</span><span class="nx">stack</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="o">);</span>
													<span class="k">if</span><span class="o">(</span><span class="nx">_instance</span><span class="o">.</span><span class="nx">appInfo</span><span class="o">.</span><span class="nx">persistenceMode</span> <span class="o">===</span> <span class="s1">&#39;top&#39;</span><span class="o">)</span> <span class="nx">stack</span> <span class="o">=</span> <span class="o">[</span><span class="nx">stack</span><span class="o">[</span><span class="m">0</span><span class="o">]];</span>
													<span class="nx">mui</span><span class="o">.</span><span class="nx">each</span><span class="o">(</span><span class="nx">stack</span><span class="o">,</span> <span class="k">function</span><span class="o">(</span><span class="nx">s</span><span class="o">)</span> <span class="o">{</span>
														<span class="k">if</span><span class="o">(</span><span class="nx">s</span><span class="o">.</span><span class="nx">timestamp</span> <span class="o">&gt;=</span> <span class="nx">cTime</span><span class="o">)</span>
														<span class="o">{</span>
															<span class="nx">cTime</span> <span class="o">=</span> <span class="nx">s</span><span class="o">.</span><span class="nx">timestamp</span><span class="o">;</span>
															<span class="nx">topNc</span> <span class="o">=</span> <span class="nx">rs</span><span class="o">.</span><span class="nx">rows</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="nx">i</span><span class="o">).</span><span class="nx">nav_controller</span><span class="o">;</span>
														<span class="o">}</span>
													<span class="o">})</span>
													<span class="nx">navCon</span><span class="o">.</span><span class="nx">restoreStack</span><span class="o">(</span><span class="nx">stack</span><span class="o">);</span>
												<span class="o">}</span>
											<span class="o">}</span>
											<span class="nx">_instance</span><span class="o">.</span><span class="nx">openUrl</span><span class="o">(</span><span class="nx">_instance</span><span class="o">.</span><span class="nx">getController</span><span class="o">(</span><span class="nx">topNc</span><span class="o">).</span><span class="nx">getLastUrl</span><span class="o">());</span>
										<span class="o">}</span>
										<span class="k">else</span>
										<span class="o">{</span>
											<span class="nx">_instance</span><span class="o">.</span><span class="nx">openUrl</span><span class="o">(</span><span class="nx">fallbackUrl</span><span class="o">);</span>
										<span class="o">}</span>
									<span class="o">});</span>
								<span class="o">});</span>
							<span class="o">}</span>

							<span class="c">// If no result, then this is first time app has ever been loaded</span>
<span class="c"></span>							<span class="k">if</span><span class="o">(</span><span class="nx">rs</span><span class="o">.</span><span class="nx">rows</span><span class="o">.</span><span class="nx">length</span> <span class="o">===</span> <span class="m">0</span><span class="o">)</span>
							<span class="o">{</span>
								<span class="nx">tx</span><span class="o">.</span><span class="nx">executeSql</span><span class="o">(</span><span class="s1">&#39;INSERT INTO mui_config (name, value) VALUES (?, ?)&#39;</span><span class="o">,</span> <span class="o">[</span><span class="s1">&#39;version&#39;</span><span class="o">,</span> <span class="nx">_instance</span><span class="o">.</span><span class="nx">appInfo</span><span class="o">.</span><span class="nx">version</span><span class="o">],</span> <span class="k">function</span><span class="o">(</span><span class="nx">tx</span><span class="o">,</span> <span class="nx">rs</span><span class="o">)</span> <span class="o">{</span>
									<span class="nx">restoreViewControllers</span><span class="o">();</span>
								<span class="o">});</span>
							<span class="o">}</span>
							<span class="k">else</span>
							<span class="o">{</span>
								<span class="nx">version</span> <span class="o">=</span> <span class="nx">rs</span><span class="o">.</span><span class="nx">rows</span><span class="o">.</span><span class="nx">item</span><span class="o">(</span><span class="m">0</span><span class="o">).</span><span class="nx">value</span><span class="o">;</span>
								<span class="c">// Check version</span>
<span class="c"></span>								<span class="k">if</span><span class="o">(</span><span class="nx">version</span> <span class="o">!==</span> <span class="nx">_instance</span><span class="o">.</span><span class="nx">appInfo</span><span class="o">.</span><span class="nx">version</span><span class="o">)</span>
								<span class="o">{</span>
									<span class="c">// Version is different, so update version wipe out all tables</span>
<span class="c"></span>									<span class="nx">tx</span><span class="o">.</span><span class="nx">executeSql</span><span class="o">(</span><span class="s1">&#39;UPDATE mui_config SET value = ? WHERE name = &quot;version&quot;&#39;</span><span class="o">,</span> <span class="o">[</span><span class="nx">_instance</span><span class="o">.</span><span class="nx">appInfo</span><span class="o">.</span><span class="nx">version</span><span class="o">],</span> <span class="k">function</span><span class="o">(</span><span class="nx">tx</span><span class="o">,</span> <span class="nx">rs</span><span class="o">)</span> <span class="o">{</span>
										<span class="c">// @TODO wipe tables</span>
<span class="c"></span>
										<span class="nx">_instance</span><span class="o">.</span><span class="nx">openUrl</span><span class="o">(</span><span class="nx">fallbackUrl</span><span class="o">);</span>
									<span class="o">});</span>
								<span class="o">}</span>
								<span class="k">else</span>
								<span class="o">{</span>
									<span class="nx">restoreViewControllers</span><span class="o">();</span>
								<span class="o">}</span>
							<span class="o">}</span>
						<span class="o">});</span>
					<span class="o">});</span>
				<span class="o">},</span> <span class="k">this</span><span class="o">));</span>	
			<span class="o">}</span>
			<span class="k">else</span>
			<span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">openUrl</span><span class="o">(</span><span class="nx">fallbackUrl</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">else</span>
		<span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">openUrl</span><span class="o">(</span><span class="nx">fallbackUrl</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">;</span>
	<span class="o">},</span>
	
	<span class="c">/**</span>
<span class="c">	 * Event disptcher</span>
<span class="c">	 * @method handleEvent</span>
<span class="c">	 * @param e {Event} The event</span>
<span class="c">	 * @private</span>
<span class="c">	 */</span>
	<span class="nx">handleEvent</span><span class="o">:</span> <span class="k">function</span><span class="o">(</span><span class="nx">e</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="nx">switch</span><span class="o">(</span><span class="nx">e</span><span class="o">.</span><span class="nx">type</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="nx">case</span> <span class="s1">&#39;touchstart&#39;</span><span class="o">:</span>
			<span class="nx">case</span> <span class="s1">&#39;mousedown&#39;</span><span class="o">:</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">_selectable</span> <span class="o">=</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">getAncestorByClassName</span><span class="o">(</span><span class="nx">e</span><span class="o">.</span><span class="nx">target</span><span class="o">,</span> <span class="s1">&#39;mui-selectable&#39;</span><span class="o">);</span>
				<span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_selectable</span><span class="o">)</span>
				<span class="o">{</span>
					<span class="k">this</span><span class="o">.</span><span class="nx">_selectablePid</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="o">(</span><span class="nx">mui</span><span class="o">.</span><span class="nx">addClass</span><span class="o">,</span> <span class="m">100</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="nx">_selectable</span><span class="o">,</span> <span class="s1">&#39;mui-selected&#39;</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="k">break</span><span class="o">;</span>
			<span class="nx">case</span> <span class="s1">&#39;touchmove&#39;</span><span class="o">:</span>
			<span class="nx">case</span> <span class="s1">&#39;mousemove&#39;</span><span class="o">:</span>
				<span class="k">if</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_selectable</span><span class="o">)</span>
				<span class="o">{</span>
					<span class="nx">clearTimeout</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_selectablePid</span><span class="o">);</span>					
					<span class="nx">mui</span><span class="o">.</span><span class="nx">removeClass</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="nx">_selectable</span><span class="o">,</span> <span class="s1">&#39;mui-selected&#39;</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">_selectable</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
				<span class="k">break</span><span class="o">;</span>
			<span class="nx">case</span> <span class="s1">&#39;click&#39;</span><span class="o">:</span>
				<span class="nx">setTimeout</span><span class="o">(</span><span class="nx">mui</span><span class="o">.</span><span class="nx">removeClass</span><span class="o">,</span> <span class="m">450</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="nx">_selectable</span><span class="o">,</span> <span class="s1">&#39;mui-selected&#39;</span><span class="o">);</span>
				<span class="k">break</span><span class="o">;</span>
		<span class="o">}</span>
	<span class="o">},</span>

	<span class="c">/**</span>
<span class="c">	 * Initialization method</span>
<span class="c">	 * @method initialize</span>
<span class="c">	 */</span>
	<span class="nx">initialize</span><span class="o">:</span> <span class="k">function</span><span class="o">()</span>
	<span class="o">{</span>
		<span class="c">// Enforce single instance of ApplicationController</span>
<span class="c"></span>		<span class="k">if</span><span class="o">(</span><span class="nx">_instance</span> <span class="o">!==</span> <span class="kc">null</span><span class="o">)</span>
		<span class="o">{</span>
			<span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="o">(</span><span class="s1">&#39;Only one instance of mui.ApplicationController allowed.&#39;</span><span class="o">);</span>
		<span class="o">}</span>
		
		<span class="c">// Cache instance</span>
<span class="c"></span>		<span class="nx">_instance</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
		
		<span class="c">// Initialize navigator</span>
<span class="c"></span>		<span class="k">this</span><span class="o">.</span><span class="nx">navigator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mui</span><span class="o">.</span><span class="nx">Navigator</span><span class="o">();</span>
		
		<span class="c">// Initialize event capture</span>
<span class="c"></span>		<span class="nx">mui</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="nb">document</span><span class="o">,</span> <span class="s1">&#39;touchstart&#39;</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
		<span class="nx">mui</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="nb">document</span><span class="o">,</span> <span class="s1">&#39;touchmove&#39;</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
		<span class="nx">mui</span><span class="o">.</span><span class="nx">on</span><span class="o">(</span><span class="nb">document</span><span class="o">,</span> <span class="s1">&#39;click&#39;</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
		
		<span class="c">// Initialize viewport and launch app</span>
<span class="c"></span>		<span class="nb">document</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">style</span><span class="o">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s1">&#39;10000px&#39;</span><span class="o">;</span> <span class="c">// so that the correct innerHeight of window can be calculated</span>
<span class="c"></span>		<span class="nx">setTimeout</span><span class="o">(</span><span class="nx">mui</span><span class="o">.</span><span class="nx">bind</span><span class="o">(</span><span class="k">function</span><span class="o">()</span> <span class="o">{</span>
			<span class="nx">scrollTo</span><span class="o">(</span><span class="m">0</span><span class="o">,</span> <span class="m">1</span><span class="o">);</span> <span class="nx">scrollTo</span><span class="o">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">);</span>
			<span class="nb">document</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">style</span><span class="o">.</span><span class="nx">minHeight</span> <span class="o">=</span> <span class="nb">window</span><span class="o">.</span><span class="nx">innerHeight</span><span class="o">+</span><span class="s1">&#39;px&#39;</span><span class="o">;</span>
			<span class="nb">document</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">style</span><span class="o">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">;</span>
			
			<span class="c">// Viewport meta</span>
<span class="c"></span>			<span class="k">this</span><span class="o">.</span><span class="nx">viewportInfo</span> <span class="o">=</span> <span class="o">{</span> <span class="nx">fullScreen</span><span class="o">:</span> <span class="kc">false</span> <span class="o">};</span>
			<span class="k">if</span><span class="o">(</span><span class="nx">mui</span><span class="o">.</span><span class="nx">UA</span><span class="o">.</span><span class="nx">Apple</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="o">.</span><span class="nx">innerHeight</span> <span class="o">&gt;=</span> <span class="m">460</span><span class="o">)</span>
			<span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="nx">viewportInfo</span><span class="o">.</span><span class="nx">fullScreen</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
				<span class="nb">document</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">parentNode</span><span class="o">.</span><span class="nx">setAttribute</span><span class="o">(</span><span class="s1">&#39;x-mui-full-screen&#39;</span><span class="o">,</span> <span class="s1">&#39;true&#39;</span><span class="o">);</span>
			<span class="o">}</span>

			<span class="c">// Initialize launch sequence</span>
<span class="c"></span>			<span class="nb">document</span><span class="o">.</span><span class="nx">body</span><span class="o">.</span><span class="nx">removeAttribute</span><span class="o">(</span><span class="s1">&#39;x-mui-loading&#39;</span><span class="o">);</span>
			<span class="k">this</span><span class="o">.</span><span class="nx">appDidFinishLaunching</span><span class="o">();</span>
		<span class="o">},</span> <span class="k">this</span><span class="o">),</span> <span class="m">100</span><span class="o">);</span>
	<span class="o">}</span>
	
<span class="o">};</span>

<span class="nx">mui</span><span class="o">.</span><span class="nx">ApplicationController</span> <span class="o">=</span> <span class="nx">ApplicationController</span><span class="o">;</span>

<span class="o">})();</span>
</pre></div>
                    </div>
			</div>
		</div>
		<div class="yui-b">
            <div class="nav">

                    <div id="moduleList" class="module">
                        <h4>Modules</h4>
                        <ul class="content">
                                <li class=""><a href="module_actionsheet.html" title="actionsheet">actionsheet</a></li>
                                <li class=""><a href="module_ajax.html" title="ajax">ajax</a></li>
                                <li class=""><a href="module_anim.html" title="anim">anim</a></li>
                                <li class=""><a href="module_datasource.html" title="datasource">datasource</a></li>
                                <li class=""><a href="module_dom.html" title="dom">dom</a></li>
                                <li class=""><a href="module_env.html" title="env">env</a></li>
                                <li class=""><a href="module_event.html" title="event">event</a></li>
                                <li class="selected"><a href="module_framework.html" title="framework">framework</a></li>
                                <li class=""><a href="module_fx.html" title="fx">fx</a></li>
                                <li class=""><a href="module_geo.html" title="geo">geo</a></li>
                                <li class=""><a href="module_loader.html" title="loader">loader</a></li>
                                <li class=""><a href="module_navigator.html" title="navigator">navigator</a></li>
                                <li class=""><a href="module_oop.html" title="oop">oop</a></li>
                                <li class=""><a href="module_pager.html" title="pager">pager</a></li>
                                <li class=""><a href="module_scroll-view.html" title="scroll-view">scroll-view</a></li>
                                <li class=""><a href="module_search-box.html" title="search-box">search-box</a></li>
                                <li class=""><a href="module_storage.html" title="storage">storage</a></li>
                                <li class=""><a href="module_swipe-view.html" title="swipe-view">swipe-view</a></li>
                                <li class=""><a href="module_tab-view.html" title="tab-view">tab-view</a></li>
                                <li class=""><a href="module_transition.html" title="transition">transition</a></li>
                                <li class=""><a href="module_util.html" title="util">util</a></li>
                        </ul>
                    </div>

                    <div id="classList" class="module">
                        <h4>Classes</h4>
                        <ul class="content">
                                <li class=""><a href="ApplicationController.html" title="ApplicationController">ApplicationController</a></li>
                                <li class=""><a href="NavigationController.html" title="NavigationController">NavigationController</a></li>
                                <li class=""><a href="ViewController.html" title="ViewController">ViewController</a></li>
                        </ul>
                    </div>

                    <div id="fileList" class="module">
                        <h4>Files</h4>
                        <ul class="content">        
                                <li class="selected"><a href="ApplicationController.js.html" title="ApplicationController.js">ApplicationController.js</a></li>
                                <li class=""><a href="NavigationController.js.html" title="NavigationController.js">NavigationController.js</a></li>
                                <li class=""><a href="ViewController.js.html" title="ViewController.js">ViewController.js</a></li>
                        </ul>
                    </div>





            </div>
		</div>
	</div>
	<div id="ft">
		<div>
        	Copyright &copy; 2009 Yahoo! Inc. All rights reserved.
		</div>
	</div>
</div>
<script type="text/javascript">
    ALL_YUI_PROPS = [{"url": "ViewController.html#method_appear", "access": "", "host": "ViewController", "type": "method", "name": "appear"}, {"url": "ApplicationController.html#property__controllers", "access": "private", "host": "ApplicationController", "type": "property", "name": "_controllers"}, {"url": "ViewController.html#method_disappear", "access": "", "host": "ViewController", "type": "method", "name": "disappear"}, {"url": "ViewController.html#method_fetchJSON", "access": "", "host": "ViewController", "type": "method", "name": "fetchJSON"}, {"url": "ViewController.html#method_fetchViewContent", "access": "", "host": "ViewController", "type": "method", "name": "fetchViewContent"}, {"url": "ApplicationController.html#method_getController", "access": "", "host": "ApplicationController", "type": "method", "name": "getController"}, {"url": "ApplicationController.html#method_getInstance", "access": "", "host": "ApplicationController", "type": "method", "name": "getInstance"}, {"url": "NavigationController.html#method_getLastUrl", "access": "", "host": "NavigationController", "type": "method", "name": "getLastUrl"}, {"url": "NavigationController.html#method_getPreviousViewController", "access": "", "host": "NavigationController", "type": "method", "name": "getPreviousViewController"}, {"url": "NavigationController.html#method_getTopViewController", "access": "", "host": "NavigationController", "type": "method", "name": "getTopViewController"}, {"url": "ViewController.html#method_getTransition", "access": "", "host": "ViewController", "type": "method", "name": "getTransition"}, {"url": "NavigationController.html#method_getViewController", "access": "", "host": "NavigationController", "type": "method", "name": "getViewController"}, {"url": "NavigationController.html#method_getViewControllerFromStack", "access": "", "host": "NavigationController", "type": "method", "name": "getViewControllerFromStack"}, {"url": "NavigationController.html#method_goBack", "access": "", "host": "NavigationController", "type": "method", "name": "goBack"}, {"url": "ApplicationController.html#method_handleEvent", "access": "private", "host": "ApplicationController", "type": "method", "name": "handleEvent"}, {"url": "NavigationController.html#method_hideNavigationBar", "access": "", "host": "NavigationController", "type": "method", "name": "hideNavigationBar"}, {"url": "ApplicationController.html#method_initialize", "access": "", "host": "ApplicationController", "type": "method", "name": "initialize"}, {"url": "NavigationController.html#method_initialize", "access": "", "host": "NavigationController", "type": "method", "name": "initialize"}, {"url": "NavigationController.html#method_initializeNavigationBar", "access": "", "host": "NavigationController", "type": "method", "name": "initializeNavigationBar"}, {"url": "NavigationController.html#method_initializeStack", "access": "", "host": "NavigationController", "type": "method", "name": "initializeStack"}, {"url": "ApplicationController.html#property__instance", "access": "", "host": "ApplicationController", "type": "property", "name": "_instance"}, {"url": "ViewController.html#method_isViewLoaded", "access": "", "host": "ViewController", "type": "method", "name": "isViewLoaded"}, {"url": "ViewController.html#method_loadView", "access": "", "host": "ViewController", "type": "method", "name": "loadView"}, {"url": "NavigationController.html#method_loadViewControllers", "access": "", "host": "NavigationController", "type": "method", "name": "loadViewControllers"}, {"url": "ViewController.html#method_map", "access": "", "host": "ViewController", "type": "method", "name": "map"}, {"url": "NavigationController.html#property_navigationBar", "access": "", "host": "NavigationController", "type": "property", "name": "navigationBar"}, {"url": "ViewController.html#method_navigationItems", "access": "", "host": "ViewController", "type": "method", "name": "navigationItems"}, {"url": "ApplicationController.html#method_objectsEqual", "access": "", "host": "ApplicationController", "type": "method", "name": "objectsEqual"}, {"url": "ApplicationController.html#method_openUrl", "access": "", "host": "ApplicationController", "type": "method", "name": "openUrl"}, {"url": "ApplicationController.html#method_openViewController", "access": "", "host": "ApplicationController", "type": "method", "name": "openViewController"}, {"url": "ViewController.html#property_persistView", "access": "", "host": "ViewController", "type": "property", "name": "persistView"}, {"url": "NavigationController.html#property_poppedStack", "access": "", "host": "NavigationController", "type": "property", "name": "poppedStack"}, {"url": "ApplicationController.html#property_popping", "access": "", "host": "ApplicationController", "type": "property", "name": "popping"}, {"url": "NavigationController.html#method_popToRootViewController", "access": "", "host": "NavigationController", "type": "method", "name": "popToRootViewController"}, {"url": "NavigationController.html#method_popToViewController", "access": "", "host": "NavigationController", "type": "method", "name": "popToViewController"}, {"url": "NavigationController.html#method_popViewController", "access": "", "host": "NavigationController", "type": "method", "name": "popViewController"}, {"url": "ApplicationController.html#method_positionViewController", "access": "", "host": "ApplicationController", "type": "method", "name": "positionViewController"}, {"url": "NavigationController.html#method_pushToViewController", "access": "", "host": "NavigationController", "type": "method", "name": "pushToViewController"}, {"url": "NavigationController.html#method_pushViewController", "access": "", "host": "NavigationController", "type": "method", "name": "pushViewController"}, {"url": "ApplicationController.html#method_registerController", "access": "", "host": "ApplicationController", "type": "method", "name": "registerController"}, {"url": "ViewController.html#method_reoladView", "access": "", "host": "ViewController", "type": "method", "name": "reoladView"}, {"url": "ApplicationController.html#method_restore", "access": "", "host": "ApplicationController", "type": "method", "name": "restore"}, {"url": "NavigationController.html#method_restoreStack", "access": "", "host": "NavigationController", "type": "method", "name": "restoreStack"}, {"url": "NavigationController.html#method_saveStack", "access": "", "host": "NavigationController", "type": "method", "name": "saveStack"}, {"url": "ViewController.html#method_setNavigationItem", "access": "", "host": "ViewController", "type": "method", "name": "setNavigationItem"}, {"url": "ApplicationController.html#method_setTabsElement", "access": "", "host": "ApplicationController", "type": "method", "name": "setTabsElement"}, {"url": "ViewController.html#method_setView", "access": "", "host": "ViewController", "type": "method", "name": "setView"}, {"url": "ViewController.html#method_setViewContent", "access": "", "host": "ViewController", "type": "method", "name": "setViewContent"}, {"url": "ApplicationController.html#method_showViewController", "access": "", "host": "ApplicationController", "type": "method", "name": "showViewController"}, {"url": "NavigationController.html#property_stack", "access": "", "host": "NavigationController", "type": "property", "name": "stack"}, {"url": "ApplicationController.html#method__tabChanged", "access": "private", "host": "ApplicationController", "type": "method", "name": "_tabChanged"}, {"url": "ApplicationController.html#method__tabRefreshed", "access": "private", "host": "ApplicationController", "type": "method", "name": "_tabRefreshed"}, {"url": "ApplicationController.html#property__tabView", "access": "private", "host": "ApplicationController", "type": "property", "name": "_tabView"}, {"url": "NavigationController.html#property_templateRegExp", "access": "private", "host": "NavigationController", "type": "property", "name": "templateRegExp"}, {"url": "ApplicationController.html#method__toggleEvents", "access": "private", "host": "ApplicationController", "type": "method", "name": "_toggleEvents"}, {"url": "ApplicationController.html#method__transitionEnd", "access": "private", "host": "ApplicationController", "type": "method", "name": "_transitionEnd"}, {"url": "ViewController.html#method_unloadView", "access": "", "host": "ViewController", "type": "method", "name": "unloadView"}, {"url": "ApplicationController.html#method__urlChanged", "access": "private", "host": "ApplicationController", "type": "method", "name": "_urlChanged"}, {"url": "ViewController.html#property_view", "access": "", "host": "ViewController", "type": "property", "name": "view"}, {"url": "NavigationController.html#property_viewControllers", "access": "", "host": "NavigationController", "type": "property", "name": "viewControllers"}, {"url": "NavigationController.html#method_viewControllerWillAppear", "access": "", "host": "NavigationController", "type": "method", "name": "viewControllerWillAppear"}, {"url": "ViewController.html#method_viewDidAppear", "access": "", "host": "ViewController", "type": "method", "name": "viewDidAppear"}, {"url": "ViewController.html#method_viewDidDisappear", "access": "", "host": "ViewController", "type": "method", "name": "viewDidDisappear"}, {"url": "ViewController.html#method__viewDidLoad", "access": "private", "host": "ViewController", "type": "method", "name": "_viewDidLoad"}, {"url": "ViewController.html#method_viewDidLoad", "access": "", "host": "ViewController", "type": "method", "name": "viewDidLoad"}, {"url": "ViewController.html#property__viewLoaded", "access": "private", "host": "ViewController", "type": "property", "name": "_viewLoaded"}, {"url": "ApplicationController.html#property_viewportInfo", "access": "", "host": "ApplicationController", "type": "property", "name": "viewportInfo"}, {"url": "ViewController.html#method_viewWillAppear", "access": "", "host": "ViewController", "type": "method", "name": "viewWillAppear"}, {"url": "ViewController.html#method_viewWillDisappear", "access": "", "host": "ViewController", "type": "method", "name": "viewWillDisappear"}, {"url": "ApplicationController.html#property_visibleViewController", "access": "", "host": "ApplicationController", "type": "property", "name": "visibleViewController"}, {"url": "ApplicationController.html#property_window", "access": "", "host": "ApplicationController", "type": "property", "name": "window"}];
</script>
</body>
</html>
